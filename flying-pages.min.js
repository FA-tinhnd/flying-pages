const toPrefetch=new Set,alreadyPrefetched=new Set,prefetcher=document.createElement("link"),isNativePrefetchSupported=prefetcher.relList&&prefetcher.relList.supports&&prefetcher.relList.supports("prefetch"),isSlowConnection=navigator.connection&&(navigator.connection.saveData||(navigator.connection.effectiveType||"").includes("2g")),prefetch=e=>isNativePrefetchSupported?new Promise((t,r)=>{const o=document.createElement("link");o.rel="prefetch",o.href=e,o.onload=t,o.onerror=r,document.head.appendChild(o)}):new Promise((t,r)=>{const o=new XMLHttpRequest;o.open("GET",e,o.withCredentials=!0),o.onload=(()=>{200===o.status?t():r()}),o.send()}),prefetchWithTimeout=e=>{const t=setTimeout(()=>stopPreloading(),5e3);prefetch(e).catch(()=>stopPreloading()).finally(()=>clearTimeout(t))},addUrlToQueue=(e,t=!1)=>{if(alreadyPrefetched.has(e)||toPrefetch.has(e))return;const r=window.location.origin;e.substring(0,r.length)===r&&window.location.href!==e&&(window.flyingPagesCofig.ignoreKeywords.forEach(t=>{e.includes(t)}),t?(prefetchWithTimeout(e),alreadyPrefetched.add(e)):toPrefetch.add(e))},observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.href;addUrlToQueue(t,!window.flyingPagesCofig.maxRPS)}})}),queue=setInterval(()=>{Array.from(toPrefetch).slice(0,window.flyingPagesCofig.maxRPS).forEach(e=>{prefetchWithTimeout(e),alreadyPrefetched.add(e),toPrefetch.delete(e)})},1e3);let hoverTimer=null;const mouseOverListener=e=>{const t=e.target.closest("a");t&&t.href&&!alreadyPrefetched.has(t.href)&&(hoverTimer=setTimeout(()=>{addUrlToQueue(t.href,!0)},window.flyingPagesCofig.mouseHoverDelay))},mouseOutListener=e=>{const t=e.target.closest("a");t&&t.href&&!alreadyPrefetched.has(t.href)&&clearTimeout(hoverTimer)},requestIdleCallback=window.requestIdleCallback||function(e){const t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},stopPreloading=()=>{document.querySelectorAll("a").forEach(e=>observer.unobserve(e)),clearInterval(queue),document.removeEventListener("mouseover",mouseOverListener,!0),document.removeEventListener("mouseout",mouseOutListener,!0)},startPreloading=()=>{document.querySelectorAll("a").forEach(e=>observer.observe(e));const e={capture:!0,passive:!0};document.addEventListener("mouseover",mouseOverListener,e),document.addEventListener("mouseout",mouseOutListener,e)},flyingPages=(e={})=>{if(isSlowConnection)return;const t=Object.assign({startDelay:0,ignoreKeywords:[],maxRPS:3,mouseHoverDelay:200},e);window.flyingPagesCofig=t,t.startDelay?setTimeout(()=>startPreloading(),1e3*t.startDelay):requestIdleCallback(()=>startPreloading())};window.flyingPagesCallback&&window.flyingPagesCallback();
